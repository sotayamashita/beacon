# Claude Code タスク実行プロンプトテンプレート

## 基本原則

Claude Codeでタスクを実行する際の汎用的なプロンプト構造です。どのようなプロジェクトやタスクリストにも適用できます。

## 汎用プロンプトテンプレート

### 初回実行時

```
以下のタスクリストを段階的に実装してください：
@[タスクリストのパス]

実装の原則：
1. 各タスクで「何を」「なぜ」実装するか説明
2. 実装前に検証方法を提示してユーザーの確認を取る
3. 実装後は必ず検証コマンドを実行して結果を表示
4. エラーが発生したら原因と解決策を説明
5. プロジェクトの規約（CLAUDE.md等）を厳守

進捗管理：
- TodoWriteツールでタスクを管理
- タスクリストファイル（todo.md等）も同時に更新
- 完了したタスクは即座に両方でマーク
- 次のタスクに移る前に現在のタスクを完全に終了
```

### 継続実行時

```
前回の続きから @[タスクリストのパス] を実装してください。

現在の状態を確認してから、未完了のタスクを順番に実装してください。
各タスクで：
1. 実装内容(What)と理由(why)を説明
2. 検証方法を事前に提示
3. 実装後に検証結果を報告
4. タスクリストファイルを更新
5. コミット
```

### 特定タスク実行時

```
@[タスクリストのパス] の [タスク番号/タスク名] を実装してください。

要件：
- 実装理由と目的を最初に説明
- 検証方法を事前に提示してユーザーの確認を取る
- 既存コードとの整合性を確認
- 実装後の検証方法を実行して結果を表示
- 問題があれば解決策を提示
- タスクリストファイルの該当箇所を更新
```

## 検証重視のプロンプト

```
[タスク内容] を実装し、以下の検証を行ってください：

1. ビルド確認
2. 単体テスト実行（あれば）
3. 統合テスト実行
4. 手動テストコマンドの実行と結果確認

各検証ステップで出力を表示し、成功/失敗を明確に報告してください。
```

## トラブルシューティング用プロンプト

```
[エラー内容/問題] が発生しています。

以下を実行してください：
1. エラーの原因を調査
2. 関連ファイルとコードを確認
3. 解決策を提示して実装
4. 修正後の動作確認
```

## プロジェクト固有の指示追加

```
@CLAUDE.md の指示に従いながら、[タスク] を実装してください。

特に以下の点に注意：
- [プロジェクト固有の規約1]
- [プロジェクト固有の規約2]
- [使用するツール/コマンド]
```

## ベストプラクティス統合プロンプト

```
[タスク] を実装してください。

実装方針：
- 小さなステップに分解して段階的に実装
- 各ステップで「なぜ」を説明してから「何を」実装
- 実装前に検証方法を明示
- 実装後は必ず動作確認
- エラー時は冷静に原因分析
- タスクリストの進捗を逐次更新

出力形式：
- 実装内容の説明
- 実際のコード/コマンド
- 実行結果
- 次のステップへの移行
```

## 効率的な進捗確認

```
現在の実装状況を確認し、残りのタスクを効率的に完了してください：

1. 完了済みタスクの確認
2. 未完了タスクのリストアップ
3. 優先順位に従って実装
4. 各タスク完了時に進捗報告
```

## Beaconプロジェクト用の実例

### Phase 1 MVP実装の開始

```
以下のタスクリストを段階的に実装してください：
@docs/todo.md

実装の原則：
1. 各タスクで「何を」「なぜ」実装するか説明
2. 実装前に検証方法を提示してユーザーの確認を取る
3. 実装後は必ず検証コマンドを実行して結果を表示
4. エラーが発生したら原因と解決策を説明
5. CLAUDE.mdの指示を厳守（特に cargo add を使用）

進捗管理：
- TodoWriteツールでタスクを管理
- docs/todo.mdのチェックボックスも更新（- [ ] を - [x] に）
- 完了したタスクは即座に両方でマーク
- 次のタスクに移る前に現在のタスクを完全に終了
```

### 統合テストの実行

```
@docs/todo.md のタスク11「統合テスト」を実装してください。

要件：
- Claude Codeの実際のJSON入力を模倣
- 各モジュールの連携を確認
- 期待される出力形式を検証

検証コマンド：
echo '{"model":{"display_name":"Opus"},"workspace":{"current_dir":"/home/user/projects/beacon"}}' | cargo run
```

## 推奨される使い方

1. **最初のプロンプト**: 汎用テンプレートでタスク全体を指示
2. **途中の確認**: 検証重視のプロンプトで品質確保
3. **問題発生時**: トラブルシューティング用プロンプト
4. **最終確認**: 効率的な進捗確認で完了を確実に

これらのテンプレートを組み合わせることで、どのようなプロジェクトでも効果的にClaude Codeを活用できます。

## CodeRabbitレビューへの対応プロンプト

### PRレビューコメントの取得と対応

```
CodeRabbitからPR #[番号] にレビューコメントが来ました。以下の手順で対応してください：

1. まず、gh コマンドでPRのコメントを取得してTodoWriter ツールでタスクを作成
2. 各コメントを個別のタスクとして実装
3. タスクごとに個別のコミットを作成
4. 最後にPRコメントで対応完了を報告

実行手順：
- gh pr view [PR番号] --comments で resolve されていないコメント確認
- gh api repos/[owner]/[repo]/pulls/[PR番号]/comments で詳細取得
- TodoWriteツールで各コメントをタスクとして管理
- 各タスクを個別にコミット（メッセージにPR番号を含める）
- gh pr comment [PR番号] --body "対応内容" で完了報告を投稿
- 投稿後、コメントURL（例: https://github.com/[owner]/[repo]/pull/[番号]#issuecomment-[ID]）が返される
```

### 実例：Module trait改善のレビュー対応

```CodeRabbitからPR #6 にレビューコメントが来ました。
コメントを１つずつ取得してTodoWrite toolで作成してください。
その後、順番にタスクを実装してコミットしてください。

各タスクで：
1. 何を修正するか明確に説明
2. なぜその修正が必要か説明
3. 実装後にテストを実行
4. 個別にコミット（メッセージ例: "fix(module): [内容] - Addresses PR #6 review comment"）
5. すべて完了後、gh pr comment 6 --body で対応内容を報告
6. 投稿結果例: https://github.com/sotayamashita/beacon/pull/6#issuecomment-3209762453
```

### 体系的なレビュー対応フロー

```
PRレビューコメントへの対応を開始します：

フェーズ1: コメント整理
- gh api でコメント取得
- TodoWriteツールでタスクリスト作成
- 優先度（Actionable > Nitpick）で分類

フェーズ2: 実装
- Actionable comments（必須修正）から対応
- 各修正を個別コミット
- テストを追加/更新

フェーズ3: 報告
- PRコメントで対応内容をサマリー
- 各コミットハッシュを含める
- テスト結果を報告
```

### レビューコメントの分類と対応優先度

```
以下の優先度でCodeRabbitのコメントに対応してください：

1. 🛠️ Refactor suggestions（必須）
   - バグ修正
   - エッジケース対応
   - セキュリティ問題

各カテゴリごとにコミットをまとめても良いが、
論理的に独立した変更は個別コミットにする
```

## Claude Code公式ベストプラクティス

[Claude Code Common workflows公式ドキュメント](https://docs.anthropic.com/en/docs/claude-code/common-workflows)より：

- **段階的な実装**: 複雑なタスクは小さなステップに分解
- **明確な説明**: 各ステップで「なぜ」を説明
- **継続的な検証**: 実装後は必ず動作確認
- **コンテキスト維持**: CLAUDE.mdで規約を明文化
- **効率的な作業**: TodoWriteツールとタスクリストファイルで進捗管理
